<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TÆ°á»›i cÃ¢y thÃ´ng minh</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1e88e5">

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2}
.box{max-width:420px;margin:auto;background:#fff;padding:15px;border-radius:10px}
h2{text-align:center}
.row{margin:6px 0}
button{width:100%;padding:12px;font-size:16px;margin-top:8px;border-radius:8px;border:none}
.manual{background:#e53935;color:#fff}
.save{background:#1e88e5;color:#fff}
input{width:100%;padding:8px;font-size:16px}
</style>
</head>

<body>
<div class="box">
<h2>ğŸŒ± TÆ¯á»šI CÃ‚Y MQTT</h2>

<div class="row">ğŸ“¶ WiFi: <b id="wifi">--</b></div>
<div class="row">âš™ï¸ Cháº¿ Ä‘á»™: <b id="mode">--</b></div>
<div class="row">ğŸŒ± Äá»™ áº©m: <span id="soil">--</span>%</div>
<div class="row">ğŸŒ§ MÆ°a: <span id="rain">--</span></div>
<div class="row">ğŸ”‹ Pin: <span id="bat">--</span> V</div>
<div class="row">ğŸš¿ BÆ¡m: <span id="pump">--</span></div>

<hr>

<label>NgÆ°á»¡ng Ä‘á»™ áº©m (%)</label>
<input type="number" id="soilSet">

<label>Thá»i gian tÆ°á»›i (phÃºt)</label>
<input type="number" id="minSet">

<label>Thá»i gian tÆ°á»›i (giÃ¢y)</label>
<input type="number" id="secSet">

<button class="save" onclick="save()">LÆ¯U CÃ€I Äáº¶T</button>
<button class="manual" onclick="manual()">ğŸš¿ TÆ¯á»šI THá»¦ CÃ”NG</button>
</div>

<script>
const client = mqtt.connect("wss://broker.hivemq.com:8000/mqtt");

client.on("connect",()=>{
  client.subscribe("tuoi/status");
});

client.on("message",(t,m)=>{
  const d = JSON.parse(m.toString());
  wifi.textContent = d.wifi ? "OK" : "Máº¤T";
  mode.textContent = d.mode;
  soil.textContent = d.soil;
  rain.textContent = d.rain ? "CÃ“" : "KHÃ”NG";
  bat.textContent = d.bat.toFixed(2);
  pump.textContent = d.pump ? "ÄANG CHáº Y" : "Táº®T";
});

function manual(){
  client.publish("tuoi/cmd","MANUAL_ON");
}

function save(){
  client.publish("tuoi/cmd","SET_SOIL:"+soilSet.value);
  client.publish("tuoi/cmd","SET_TIME:"+minSet.value+":"+secSet.value);
}

// PWA
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>
